<!DOCTYPE html>
<!--
Created using JS Bin
http://jsbin.com

Copyright (c) 2023 by anonymous (http://jsbin.com/hocewozusa/1/edit)

Released under the MIT license: http://jsbin.mit-license.org
-->
<meta name="robots" content="noindex">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>새학년 학급편성 프로그램</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <style>
        /* 여기에 CSS 스타일을 추가 */
        .classTable, .classTable th, .classTable td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        .classTable th, .classTable td {
            padding: 5px;
            text-align: left;
        }
        .dropHover {
            background-color: #d3d3d3;
        }
    </style>
</head>
<body>
    <h1>새학년 학급편성 프로그램</h1>
    <div>
        <label for="numClasses">학급 수 설정: </label>
        <input type="number" id="numClasses" min="1">
    </div>
    <div>
        <label for="csvFile">CSV 파일 업로드: </label>
        <input type="file" id="csvFile" accept=".csv">
    </div>
    <div id="classResults">
        <!-- 여기에 학급별 결과를 표시 -->
    </div>
    <div id="manual">
        <!-- 여기에 사용자 메뉴얼 내용을 표시 -->
    </div>

    <script>
        $(document).ready(function() {
            $('#csvFile').on('change', function(event) {
                var file = event.target.files[0];
                var reader = new FileReader();
                
                reader.onload = function(e) {
                    var text = e.target.result;
                    var data = parseCSV(text);
                    var numClasses = parseInt($('#numClasses').val());
                    var distributedClasses = distributeStudents(data, numClasses);
                    displayClasses(distributedClasses);
                };

                reader.readAsText(file);
            });

            function parseCSV(text) {
                var lines = text.split('\n');
                var result = [];
                var headers = lines[0].split(',');

                for(var i=1; i<lines.length; i++){
                    var obj = {};
                    var currentline = lines[i].split(',');

                    for(var j=0; j<headers.length; j++){
                        obj[headers[j]] = currentline[j];
                    }

                    result.push(obj);
                }
                
                return result;
            }

            function distributeStudents(data, numClasses) {
                var classes = Array.from({ length: numClasses }, () => []);

                data.forEach((student, index) => {
                    var classIndex = index % numClasses;
                    classes[classIndex].push(student);
                });

                return classes;
            }

            function displayClasses(classes) {
                $('#classResults').empty();

                classes.forEach(function(cls, index) {
                    var table = $('<table></table>').addClass('classTable');
                    var thead = $('<thead></thead>');
                    var tbody = $('<tbody></tbody>');

                    thead.append('<tr><th>학년</th><th>반</th><th>번호</th><th>성별</th><th>이름</th><th>학급내성별석차</th><th>지도곤란도</th><th>비고</th></tr>');
                    cls.forEach(function(student) {
                        var row = $('<tr></tr>').addClass('student');
                        Object.values(student).forEach(function(val) {
                            row.append('<td>' + val + '</td>');
                        });
                        tbody.append(row);
                    });

                    table.append(thead);
                    table.append(tbody);
                    $('#classResults').append('<h3>학급 ' + (index + 1) + '</h3>');
                    $('#classResults').append(table);
                });

                enableDragAndDrop();
            }

            function enableDragAndDrop() {
                $(".student").draggable({
                    helper: 'clone',
                    zIndex: 100
                });

                $(".classTable tbody").droppable({
                    hoverClass: 'dropHover',
                    drop: function(event, ui) {
                        var student = ui.draggable;
                        var newClass = $(this);
                        newClass.append(student);
                    }
                });
            }
        });
    </script>
</body>
</html>
